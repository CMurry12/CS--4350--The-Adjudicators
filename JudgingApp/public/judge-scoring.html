<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Judge Scoring</title>
  <style>
    body {
      background: linear-gradient(to right, #667eea, #764ba2);
      font-family: Arial, sans-serif;
      padding: 100px 20px 20px;
      color: #fff;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 10px;
    }

    h2 {
      margin-bottom: 20px;
    }

    select, input, textarea {
      width: 100%;
      margin-top: 8px;
      padding: 8px;
      border-radius: 5px;
      border: none;
    }

    .project {
      background: rgba(255, 255, 255, 0.2);
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
    }

    .btn {
      margin-top: 10px;
      background-color: #ffd700;
      color: black;
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .btn:hover {
      background-color: #f4c400;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Judge Scoring Panel</h2>
    <label for="eventSelect">Select Event:</label>
    <select id="eventSelect">
      <option value="">-- Select an Event --</option>
    </select>

    <div id="projectList" style="margin-top: 30px;"></div>
  </div>

  <script>
    const judge = JSON.parse(localStorage.getItem("user")) || { id: "guest" };

    async function fetchEvents() {
      const res = await fetch("http://localhost:3000/api/events");
      const events = await res.json();
      const dropdown = document.getElementById("eventSelect");

      events.forEach(event => {
        const option = document.createElement("option");
        option.value = event.id;
        option.textContent = `${event.name} (${event.date})`;
        dropdown.appendChild(option);
      });
    }

    document.getElementById("eventSelect").addEventListener("change", async (e) => {
      const eventId = e.target.value;
      if (!eventId) return;

      const res = await fetch(`http://localhost:3000/api/projects/event/${eventId}`);
      const projects = await res.json();
      const projectList = document.getElementById("projectList");
      projectList.innerHTML = "";

      projects.forEach(project => {
        const div = document.createElement("div");
        div.className = "project";
        div.innerHTML = `
          <h3>${project.title}</h3>
          <p><strong>Description:</strong> ${project.description}</p>
          <p><a href="http://localhost:3000/uploads/${project.file_path}" target="_blank" style="color:gold;">View Project File</a></p>

          <label>Creativity (0–10)</label>
          <input type="number" min="0" max="10" id="creativity-${project.id}"/>

          <label>Impact (0–10)</label>
          <input type="number" min="0" max="10" id="impact-${project.id}"/>

          <label>Execution (0–10)</label>
          <input type="number" min="0" max="10" id="execution-${project.id}"/>

          <label>Feasibility (0–10)</label>
          <input type="number" min="0" max="10" id="feasibility-${project.id}"/>

          <label>Design (0–10)</label>
          <input type="number" min="0" max="10" id="design-${project.id}"/>

          <label>Feedback</label>
          <textarea id="feedback-${project.id}" rows="3"></textarea>

          <button class="btn" onclick="submitReview(${project.id})">Submit Review</button>
        `;
        projectList.appendChild(div);
      });
    });

    async function submitReview(projectId) {
      const getVal = (field) => parseFloat(document.getElementById(`${field}-${projectId}`).value) || 0;

      const data = {
        judgeId: judge.id,
        projectId,
        creativity: getVal("creativity"),
        impact: getVal("impact"),
        execution: getVal("execution"),
        feasibility: getVal("feasibility"),
        design: getVal("design"),
        feedback: document.getElementById(`feedback-${projectId}`).value
      };

      const res = await fetch("http://localhost:3000/api/projects/review", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const result = await res.json();
      alert(result.message || "Review submitted.");
    }

    fetchEvents();
  </script>
</body>
</html>
